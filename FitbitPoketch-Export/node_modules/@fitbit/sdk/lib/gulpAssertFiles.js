"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const path_1 = tslib_1.__importDefault(require("path"));
const stream_1 = tslib_1.__importDefault(require("stream"));
const humanize_list_1 = tslib_1.__importDefault(require("humanize-list"));
const plugin_error_1 = tslib_1.__importDefault(require("plugin-error"));
const PLUGIN_NAME = 'assert-files';
function vinylAssertFiles(expected) {
    const expectedPaths = new Set(expected.map(path_1.default.normalize));
    return new stream_1.default.Transform({
        objectMode: true,
        transform(file, _, cb) {
            if (!file.isNull())
                expectedPaths.delete(file.relative);
            cb(undefined, file);
        },
        flush(cb) {
            if (expectedPaths.size !== 0) {
                this.emit('error', new plugin_error_1.default(PLUGIN_NAME, `One or more required files do not exist in the project: ${humanize_list_1.default([...expectedPaths])}`));
            }
            cb();
        },
    });
}
exports.default = vinylAssertFiles;
